# Rate Limiting for AI Bots (Nginx)
# Protects your server from aggressive AI crawling

# FIXED VERSION: Uses map instead of if directive

# Define AI bot detection
map $http_user_agent $is_ai_bot {
    ~*(GPTBot|ClaudeBot|PerplexityBot|OAI-SearchBot|google-extended|anthropic-ai|DeepSeek-Bot|Gemini-Bot) 1;
    default 0;
}

# Define rate limit zone (10 requests per minute)
limit_req_zone $http_user_agent zone=ai_bots:10m rate=10r/m;

# Apply to specific endpoints
location /query-index.json {
    if ($is_ai_bot = 1) {
        limit_req zone=ai_bots burst=5 nodelay;
    }
}

location /llms.txt {
    if ($is_ai_bot = 1) {
        limit_req zone=ai_bots burst=5 nodelay;
    }
}
